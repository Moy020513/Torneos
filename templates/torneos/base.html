{% extends 'base.html' %}
{% load static %}

{% block title %}{% if categoria %}{{ categoria.nombre }} - {% endif %}Sistema de Torneos{% endblock %}

{% block extra_css %}
<style>
  /* Barra superior y navegación elegante con acento neón */
  .torneos-header.card{
    border-radius: 16px;
    border: 2px solid #ffffffff;
    box-shadow: 0 0 12px 4px #08F7FE, 0 2px 24px rgba(8,247,254,0.18);
  }
  
  /* Layout con logo a la izquierda, texto centro, franjas derecha */
  .torneos-header-layout {
    background: linear-gradient(120deg, #0a2342 0 2.5%, #08F7FE 2.5% 5%, #00cfff 5% 7.5%, #fff 7.5% 100%);
  }
  
  .torneos-header .card-body {
    padding: 1rem;
    min-height: 100px;
  }
  
  .torneos-header .header-left {
    flex-shrink: 0;
    width: 80px;
  }
  
  .torneos-header .header-logo{
    width:80px; height:80px; display:flex; align-items:center; justify-content:center; overflow:hidden; background:transparent; box-shadow:none; border:none;
  }
  .torneos-header .header-logo img{ max-width:100%; max-height:100%; object-fit:contain; border:none; box-shadow:none; }

  .torneos-nav{
    background:#fff; border:1px solid rgba(8,247,254,.35); border-radius:12px; padding:8px; box-shadow:0 8px 20px rgba(0,0,0,.06); width:100%;
  }
  .torneos-nav .nav-link{
    border-radius:10px; font-weight:700; color:#0a2342; border:1px solid transparent;
  }
  .torneos-nav .nav-link:hover{
    background:rgba(8,247,254,.10); border-color:rgba(8,247,254,.35);
  }
  .torneos-nav .nav-link.active{
    background:#0a2342; color:#eaf7ff; border-color:#0a2342; box-shadow:0 0 0 3px rgba(8,247,254,.18);
  }
  .torneos-nav .nav-link i{ color:#08F7FE; }

  .torneos-actions{ gap:8px; }
  .btn-navy{ background:#0a2342; border:1px solid #0a2342; color:#fff; }
  .btn-navy:hover{ background:#0c2850; border-color:#0c2850; }

  /* Menú hamburguesa responsivo */
  .menu-toggle-btn {
    background: #0a2342;
    border: 1px solid #ffffffff;
    box-shadow: 0 0 8px rgba(0, 247, 255, 0.68);
    color: #fff;
    padding: 0.5rem 0.75rem;
    border-radius: 8px;
    cursor: pointer;
    display: none;
  }

  .menu-toggle-btn:hover {
    background: #0c2850;
  }

  .torneos-nav-mobile {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: #fff;
    border: 1px solid rgba(8,247,254,.35);
    border-radius: 12px;
    margin-top: 8px;
    box-shadow: 0 8px 20px rgba(0,0,0,.15);
    padding: 8px;
    z-index: 1000;
  }

  .torneos-nav-mobile.show {
    display: flex;
    flex-direction: column;
  }

  .torneos-nav-mobile .nav-link {
    border-radius: 10px;
    font-weight: 700;
    color: #0a2342;
    border: 1px solid transparent;
    padding: 0.75rem 1rem;
    text-align: left;
    width: 100%;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .torneos-nav-mobile .nav-link:hover {
    background: rgba(8,247,254,.10);
    border-color: rgba(8,247,254,.35);
  }

  .torneos-nav-mobile .nav-link.active {
    background: #0a2342;
    color: #eaf7ff;
    border-color: #0a2342;
  }

  .torneos-nav-mobile .nav-link i {
    color: #08F7FE;
    min-width: 20px;
  }

  /* Centrado en móvil */
  @media (max-width: 768px) {
    .torneos-header .header-left {
      position: relative !important;
      left: auto !important;
      width: auto;
      margin-bottom: 0.5rem;
    }

    .torneos-header .card-body {
      flex-direction: column !important;
      text-align: center;
    }

    .torneos-header .header-center {
      margin-left: 0 !important;
      width: 100%;
    }

    .torneos-header .header-logo {
      width: 60px;
      height: 60px;
      margin: 0 auto;
    }
  }

  @media (max-width: 991px) {
    .torneos-nav {
      display: none;
    }

    .menu-toggle-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .torneos-nav-mobile-container {
      position: relative;
      width: 100%;
    }
  }

  @media (min-width: 992px) {
    .torneos-nav-mobile-container {
      display: none;
    }
  }

  /* CSS para tabla de clasificación en móvil */
  @media (max-width: 576px) {
    .tabla-posiciones-card {
      margin: 0 -12px !important;
      width: calc(100% + 24px) !important;
      max-width: calc(100% + 24px) !important;
      border-radius: 0 !important;
    }
    
    .tabla-posiciones-card .card-body {
      padding: 0 !important;
    }
    
    .tabla-posiciones {
      width: 100% !important;
      min-width: 100% !important;
      max-width: 100% !important;
      margin: 0 !important;
    }
    
    .table-responsive {
      margin: 0 !important;
      border-radius: 0 !important;
    }
    
    .tabla-simbolos li {
      font-size: 0.55rem !important;
    }
    
    .tabla-posiciones th,
    .tabla-posiciones td {
      font-size: 0.65rem !important;
    }
  }

  /* Centrar todos los td y th excepto la columna Equipo */
  .tabla-posiciones th:not(:nth-child(2)),
  .tabla-posiciones td:not(:nth-child(2)) {
    text-align: center !important;
    vertical-align: middle !important;
  }

  /* Reducir altura de las filas de la tabla de posiciones */
  .tabla-posiciones th,
  .tabla-posiciones td {
    padding-top: 0.01rem !important;
    padding-bottom: 0.01rem !important;
    font-size: 0.80em !important;
  }
</style>
{% endblock %}

{% block content %}
  {% with url_name=request.resolver_match.url_name %}
  <div class="row mb-3">
    <div class="col-12">
      <div class="card torneos-header torneos-header-layout text-white">
        <div class="card-body d-flex align-items-center justify-content-center position-relative">
          <div class="header-left position-absolute" style="left: 1.25rem;">
            {% if categoria and categoria.torneo.logo %}
            <a class="header-logo has-image" href="{% url 'torneo_detalle' categoria.torneo.id %}">
              <img src="{{ categoria.torneo.logo.url }}" alt="{{ categoria.torneo.nombre }}">
            </a>
            {% endif %}
          </div>
          
          <div class="header-center text-center" style="margin-left: -40px;">
            {% if categoria %}
            <h2 class="h4 text-navy m-0">{{ categoria.nombre }}</h2>
            <div class="mt-2">
              <a href="{% url 'torneo_detalle' categoria.torneo.id %}" class="btn btn-navy btn-sm">
              <i class="fa-solid fa-arrow-left"></i> Volver al Torneo
              </a>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>

  {% if categoria %}
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex justify-content-center align-items-center flex-wrap" style="gap:12px;">
        <!-- Menú Desktop -->
        <ul class="nav nav-pills torneos-nav w-100 justify-content-center flex-wrap mx-auto">
          <li class="nav-item">
            <a class="nav-link {% if url_name == 'categoria_detalle' %}active{% endif %}" href="{% url 'categoria_detalle' categoria.id %}"><i class="fa-solid fa-calendar-day"></i> Próximos</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if url_name == 'resultados' %}active{% endif %}" href="{% url 'resultados' categoria.id %}"><i class="fa-solid fa-list-check"></i> Resultados</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if url_name == 'tabla_posiciones' %}active{% endif %}" href="{% url 'tabla_posiciones' categoria.id %}"><i class="fa-solid fa-table-list"></i> Clasificación</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if url_name == 'equipos' %}active{% endif %}" href="{% url 'equipos' categoria.id %}"><i class="fa-solid fa-people-group"></i> Equipos</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if url_name == 'goleadores' %}active{% endif %}" href="{% url 'goleadores' categoria.id %}"><i class="fa-solid fa-bullseye"></i> Goleadores</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if url_name == 'jugadores' %}active{% endif %}" href="{% url 'jugadores' categoria.id %}"><i class="fa-solid fa-users"></i> Jugadores</a>
          </li>
          {% if categoria.tiene_eliminatorias %}
          <li class="nav-item">
            <a class="nav-link {% if url_name == 'eliminatorias' %}active{% endif %}" href="{% url 'eliminatorias' categoria.id %}"><i class="fa-solid fa-bracket"></i> Eliminatorias</a>
          </li>
          {% endif %}
          <li class="nav-item">
            <a class="nav-link {% if url_name == 'estadisticas' %}active{% endif %}" href="{% url 'estadisticas' categoria.id %}"><i class="fa-solid fa-chart-simple"></i> Estadísticas</a>
          </li>
        </ul>

        <!-- Menú Móvil Hamburguesa -->
        <div class="torneos-nav-mobile-container w-100">
          <button class="menu-toggle-btn w-100" onclick="toggleMobileMenu()">
            <i class="fa-solid fa-bars"></i> Menú
          </button>
          <div class="torneos-nav-mobile" id="mobileMenu">
            <a class="nav-link {% if url_name == 'categoria_detalle' %}active{% endif %}" href="{% url 'categoria_detalle' categoria.id %}"><i class="fa-solid fa-calendar-day"></i> Próximos</a>
            <a class="nav-link {% if url_name == 'resultados' %}active{% endif %}" href="{% url 'resultados' categoria.id %}"><i class="fa-solid fa-list-check"></i> Resultados</a>
            <a class="nav-link {% if url_name == 'tabla_posiciones' %}active{% endif %}" href="{% url 'tabla_posiciones' categoria.id %}"><i class="fa-solid fa-table-list"></i> Clasificación</a>
            <a class="nav-link {% if url_name == 'equipos' %}active{% endif %}" href="{% url 'equipos' categoria.id %}"><i class="fa-solid fa-people-group"></i> Equipos</a>
            <a class="nav-link {% if url_name == 'goleadores' %}active{% endif %}" href="{% url 'goleadores' categoria.id %}"><i class="fa-solid fa-bullseye"></i> Goleadores</a>
            <a class="nav-link {% if url_name == 'jugadores' %}active{% endif %}" href="{% url 'jugadores' categoria.id %}"><i class="fa-solid fa-users"></i> Jugadores</a>
            {% if categoria.tiene_eliminatorias %}
            <a class="nav-link {% if url_name == 'eliminatorias' %}active{% endif %}" href="{% url 'eliminatorias' categoria.id %}"><i class="fa-solid fa-bracket"></i> Eliminatorias</a>
            {% endif %}
            <a class="nav-link {% if url_name == 'estadisticas' %}active{% endif %}" href="{% url 'estadisticas' categoria.id %}"><i class="fa-solid fa-chart-simple"></i> Estadísticas</a>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endif %}

  {% block categoria_content %}{% endblock %}
  {% endwith %}

  <script>
    function toggleMobileMenu() {
      const menu = document.getElementById('mobileMenu');
      menu.classList.toggle('show');
    }

    // Cerrar menú al hacer clic en un enlace
    document.querySelectorAll('.torneos-nav-mobile .nav-link').forEach(link => {
      link.addEventListener('click', function() {
        document.getElementById('mobileMenu').classList.remove('show');
      });
    });

    // Cerrar menú al hacer clic fuera
    document.addEventListener('click', function(event) {
      const menu = document.getElementById('mobileMenu');
      const btn = document.querySelector('.menu-toggle-btn');
      if (menu && btn && !menu.contains(event.target) && !btn.contains(event.target)) {
        menu.classList.remove('show');
      }
    });
  </script>
{% endblock %}