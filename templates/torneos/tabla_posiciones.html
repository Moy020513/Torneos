{% extends 'torneos/base.html' %}
{% block categoria_content %}
    <!-- Encabezado/nav heredados desde torneos/base.html -->
    <div class="card w-100 tabla-posiciones-card" style="max-width:100vw;">
        <div class="card-header">
            <h3 class="m-0 text-navy"><i class="fa-solid fa-table-list"></i> Clasificación</h3>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-bordered w-100 text-center tabla-posiciones">
                <thead>
                    <tr>
                        <th>POS</th>
                            <th>EQUIPO</th>
                        <th>PJ</th>
                        <th>PG</th>
                        <th>PE</th>
                        <th>PP</th>
                        <th>GF</th>
                        <th>GC</th>
                        <th>DG</th>
                        <th>PTS</th>
                        <th>AJUSTES</th>
                    </tr>
                </thead>
                <tbody>
                    {% for equipo in equipos %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td style="white-space:nowrap;">
                            <span style="display: flex; align-items: center; gap: 8px; height: 40px; justify-content: flex-start; text-align: left;">
                                {% if equipo.logo %}
                                    <img src="{{ equipo.logo.url }}" alt="{{ equipo.nombre }}" style="width:32px; height:32px; object-fit:contain; display: block;">
                                {% endif %}
                                <span class="team-name" data-full="{{ equipo.nombre|escape }}" style="display: inline-block; align-items: center; font-weight: bold;" title="{{ equipo.nombre }}">{{ equipo.nombre }}</span>
                            </span>
                        </td>
                        <td>{{ equipo.partidos_jugados }}</td>
                        <td>{{ equipo.partidos_ganados }}</td>
                        <td>{{ equipo.partidos_empatados }}</td>
                        <td>{{ equipo.partidos_perdidos }}</td>
                        <td>{{ equipo.goles_favor }}</td>
                        <td>{{ equipo.goles_contra }}</td>
                        <td>{{ equipo.diferencia_goles }}</td>
                        <td>
                            <strong>
                                {{ equipo.puntos_totales }}
                                {% if equipo.total_ajuste_puntos %}
                                    <span style="{% if equipo.total_ajuste_puntos > 0 %}color: green;{% elif equipo.total_ajuste_puntos < 0 %}color: red;{% endif %}">*</span>
                                {% endif %}
                            </strong>
                        </td>
                        <td>
                            {% if equipo.total_ajuste_puntos %}
                                <span style="{% if equipo.total_ajuste_puntos > 0 %}color: green; font-weight: bold;{% elif equipo.total_ajuste_puntos < 0 %}color: red; font-weight: bold;{% endif %}">
                                    {% if equipo.total_ajuste_puntos > 0 %}+{% endif %}{{ equipo.total_ajuste_puntos }}
                                </span>
                            {% else %}
                                <span style="color: gray;">0</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <!-- Simbología de la tabla -->
    <div class="mt-4 mb-2 p-3 bg-light rounded shadow-sm" style="max-width:100vw;">
    <h5 class="fw-bold mb-2 text-navy"><i class="fa-solid fa-info-circle"></i> Simbología</h5>
    <ul class="mb-0 row row-cols-3 g-2 tabla-simbolos" style="list-style:none; padding-left:0;">
            <li class="col"><strong>POS</strong>: Posición en la tabla</li>
            <li class="col"><strong>PJ</strong>: Partidos Jugados</li>
            <li class="col"><strong>PG</strong>: Partidos Ganados</li>
            <li class="col"><strong>PE</strong>: Partidos Empatados</li>
            <li class="col"><strong>PP</strong>: Partidos Perdidos</li>
            <li class="col"><strong>GF</strong>: Goles a Favor</li>
            <li class="col"><strong>GC</strong>: Goles en Contra</li>
            <li class="col"><strong>DG</strong>: Diferencia de Goles</li>
            <li class="col"><strong>PTS</strong>: Puntos Totales (con asterisco * si hay ajustes)</li>
            <li class="col"><strong>AJUSTES</strong>: Ajustes administrativos (verde +, rojo -)</li>
        </ul>
        <style>
@media (max-width: 576px) {

    /* Reducir tamaño del logo en móvil */
.tabla-posiciones td img {
    width: 22px !important;
    height: 22px !important;
    object-fit: contain !important;
}

    .tabla-posiciones-card {
        margin: 0 -12px !important;
        width: calc(100% + 24px) !important;
        max-width: calc(100% + 24px) !important;
        border-radius: 0 !important;
    }
    .tabla-posiciones-card .card-body {
        font-size: 0.70rem !important;
    }
    
    .tabla-posiciones-card .card-body {
        padding: 0 !important;
    }
    
    .tabla-posiciones {
        width: 100% !important;
        min-width: 100% !important;
        max-width: 100% !important;
        margin: 0 !important;
    }
    
    .table-responsive {
        margin: 0 !important;
        border-radius: 0 !important;
    }
    
    .tabla-simbolos li {
        font-size: 0.55rem !important;
    }
    
    .tabla-posiciones th,
    .tabla-posiciones td {
        font-size: 0.65rem !important;
    }
  .tabla-posiciones td {
    padding-top: 0 !important;
    padding-bottom: 0 !important;
  }
}

/* Ajustes adicionales para mover logo/nombre más a la izquierda en móvil */
@media (max-width: 576px) {
    /* Reducir padding general de celdas para ganar espacio */
    .tabla-posiciones td {
        padding-left: 6px !important;
        padding-right: 6px !important;
    }

    /* Columna EQUIPO (segunda columna) más a la izquierda */
    .tabla-posiciones td:nth-child(2) {
        padding-left: 2px !important;
    }

    /* Hacer que el wrapper del logo y nombre se desplace ligeramente a la izquierda */
    .tabla-posiciones td:nth-child(2) > span {
        margin-left: 0px !important;
        padding-left: 0 !important;
        gap: 6px !important;
    }

    /* Quitar margen izquierdo de la imagen si existe */
    .tabla-posiciones td:nth-child(2) img {
        margin-left: 0 !important;
    }

    /* Truncar y controlar overflow del nombre del equipo */
.team-name {
    display: inline-block;
    max-width: 9.5rem;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    vertical-align: middle;
    line-height: 1.15;
    display: inline-flex;
    align-items: center;
    padding-top: 1px;
}
}
    /* Sobre-escribir alturas fijas inline en la columna EQUIPO y ajustar alineamiento */
    .tabla-posiciones td > span {
        height: auto !important;
        min-height: 0 !important;
        gap: 6px !important;
        padding: 2px 6px !important;
        align-items: center !important;
    }

    .tabla-posiciones td > span > span {
        height: auto !important;
        line-height: 1.15 !important;
        display: inline-flex !important;
        align-items: center !important;
        font-weight: 600 !important;
        padding-top: 2px !important;
    }

    /* Asegurar que las imágenes queden centradas y pequeñas */
    .tabla-posiciones td img {
        vertical-align: middle !important;
        margin-right: 6px !important;
    }

/* Centrar todos los td y th excepto la columna Equipo */
.tabla-posiciones th:not(:nth-child(2)),
.tabla-posiciones td:not(:nth-child(2)) {
    text-align: center !important;
    vertical-align: middle !important;
}

/* Reducir altura de las filas de la tabla de posiciones */
.tabla-posiciones th,
.tabla-posiciones td {
    padding-top: 0.01rem !important;
    padding-bottom: 0.01rem !important;
    font-size: 0.80em !important;
}

th {
    background-color: #0a2342!important;
    color: white !important;
}
</style>

<script>
// Trunca el nombre de equipos a 13 caracteres solo en móvil (<=576px)
(function(){
    function truncateNames(){
        var isMobile = window.innerWidth <= 576;
        var max = 13;
        document.querySelectorAll('.team-name').forEach(function(el){
            var full = el.getAttribute('data-full') || el.textContent || '';
            if(isMobile){
                if(full.length > max){
                    el.textContent = full.slice(0, max) + '...';
                } else {
                    el.textContent = full;
                }
            } else {
                el.textContent = full;
            }
        });
    }

    // Ensure data-full exists for all elements (fallback)
    document.querySelectorAll('.team-name').forEach(function(el){
        if(!el.getAttribute('data-full')){
            el.setAttribute('data-full', el.getAttribute('title') || el.textContent || '');
        }
    });

    window.addEventListener('resize', truncateNames);
    document.addEventListener('DOMContentLoaded', truncateNames);
    // Run once immediately in case DOM is already loaded
    truncateNames();
})();
</script>
    </div>
{% endblock %}
