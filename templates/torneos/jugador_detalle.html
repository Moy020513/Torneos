{% extends 'torneos/base.html' %}
{% load custom_filters %}
{% load static %}

{% block title %}{{ jugador.nombre }} {{ jugador.apellido }} - Detalle del Jugador{% endblock %}

{% block extra_css %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'css/jugador_detalle.css' %}">
{% endblock %}
{% block categoria_content %}
<div class="container mt-3 mt-lg-5 mb-4 mb-lg-5 px-2 px-lg-3">
    <!-- Hero Section con foto de perfil -->
    <div class="card shadow-lg border-0 mb-3 mb-lg-4 overflow-hidden">
        <div class="row g-0">
            <div class="col-lg-4 bg-gradient position-relative" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 200px;">
                <div class="d-flex align-items-center justify-content-center h-100 p-3 p-lg-4">
                {% if jugador.foto %}
                    <div class="text-center">
                        <img src="{{ jugador.foto.url }}" 
                            class="rounded-circle border border-3 border-lg-5 border-white shadow-lg mobile-avatar" 
                            alt="Foto de {{ jugador.nombre }}" 
                            style="width: 130px; height: 130px; object-fit: contain; image-rendering:auto; cursor:pointer;"
                            onclick="expandirFoto('{{ jugador.foto.url }}', '{{ jugador.nombre }} {{ jugador.apellido }}')">
                        {% if jugador.verificado %}
                            <div class="mt-2">
                                <span class="badge bg-success">VERIFICADO</span>
                            </div>
                        {% endif %}
                    </div>
                {% else %}
                    <div class="text-center">
                        <img src="/static/img/default_avatar.png" 
                            class="rounded-circle border border-3 border-lg-5 border-white shadow-lg mobile-avatar" 
                            alt="Sin foto" 
                            style="width: 130px; height: 130px; object-fit: contain; image-rendering:auto; cursor:pointer;"
                            onclick="expandirFoto('/static/img/default_avatar.png', 'Sin foto')">
                    </div>
                {% endif %}
                </div>
            </div>
            <div class="col-lg-8">
                <div class="card-body p-3 p-lg-5">
                    <div class="d-flex justify-content-between align-items-start mb-2 mb-lg-3">
                        <div class="flex-grow-1 me-2">
                            <h1 class="mobile-title fw-bold mb-1 mb-lg-2">{{ jugador.nombre }} {{ jugador.apellido }}</h1>
                            <p class="text-muted mobile-team mb-0">
                                
                                {% if jugador.equipo.logo %}
                                    <img src="{{ jugador.equipo.logo.url }}" alt="Logo {{ jugador.equipo.nombre }}" style="height:32px; width:auto; margin-right:6px; vertical-align:middle; object-fit:contain; border-radius:6px; background:#fff; border:1px solid #eee;">
                                {% endif %}
                                {{ jugador.equipo.nombre }}
                            </p>
                        </div>
                        <span class="badge bg-primary mobile-badge px-3 py-2" style="min-width: 50px;">
                            #{{ jugador.numero_camiseta }}
                        </span>
                    </div>
                    
                    <div class="row g-2 g-lg-4 mt-2 mt-lg-3">
                        <div class="col-6 col-md-6">
                            <div class="d-flex align-items-center">
                                <div class="bg-light rounded-circle mobile-icon-wrapper me-2 me-lg-3">
                                    <i class="bi bi-calendar3 text-primary mobile-icon"></i>
                                </div>
                                <div>
                                    <small class="text-muted d-block mobile-label">Fecha de nacimiento</small>
                                    <strong class="mobile-value">{{ jugador.fecha_nacimiento|date:'d/m/Y' }}</strong>
                                </div>
                            </div>
                        </div>
                        <div class="col-6 col-md-6">
                            <div class="d-flex align-items-center">
                                <div class="bg-light rounded-circle mobile-icon-wrapper me-2 me-lg-3">
                                    <i class="bi bi-hourglass-split text-success mobile-icon"></i>
                                </div>
                                <div>
                                    <small class="text-muted d-block mobile-label">Edad</small>
                                    <strong class="mobile-value">{{ jugador.fecha_nacimiento|calcular_edad }} a침os</strong>
                                </div>
                            </div>
                        </div>
                        <div class="col-6 col-md-6">
                            <div class="d-flex align-items-center">
                                <div class="bg-light rounded-circle mobile-icon-wrapper me-2 me-lg-3">
                                    <i class="bi bi-trophy text-warning mobile-icon"></i>
                                </div>
                                <div>
                                    <small class="text-muted d-block mobile-label">Partidos jugados</small>
                                    <strong class="mobile-value">{{ jugador.participaciones.count }}</strong>
                                </div>
                            </div>
                        </div>
                        <div class="col-6 col-md-6">
                            <div class="d-flex align-items-center">
                                <div class="bg-light rounded-circle mobile-icon-wrapper me-2 me-lg-3">
                                    <i class="bi bi-person-badge text-info mobile-icon"></i>
                                </div>
                                <div>
                                    <small class="text-muted d-block mobile-label">Posici칩n</small>
                                    <strong class="mobile-value">{{ jugador.get_posicion_display }}</strong>
                                </div>
                            </div>
                        </div>
                        <div class="col-6 col-md-6">
                            <div class="d-flex align-items-center">
                                <div class="bg-light rounded-circle mobile-icon-wrapper me-2 me-lg-3">
                                    <i class="bi bi-people-fill text-secondary mobile-icon"></i>
                                </div>
                                <div>
                                    <small class="text-muted d-block mobile-label">Fecha de registro</small>
                                    <strong class="mobile-value">{{ jugador.fecha_creacion|date:'d/m/Y H:i' }}</strong>
                                </div>
                            </div>
                        </div>  
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Secci칩n de Participaciones -->
    <div class="card shadow-sm border-0">
        <div class="card-header bg-white border-0 pt-3 pt-lg-4 pb-2 pb-lg-3 px-3 px-lg-4">
            <div class="d-flex align-items-center justify-content-between">
                <h4 class="mb-0 fw-bold mobile-section-title">
                    <i class="bi bi-list-check me-1 me-lg-2 text-primary"></i>Historial de Participaciones
                </h4>
                <span class="badge bg-light text-dark mobile-count-badge">{{ participaciones|length }}</span>
            </div>
        </div>
        <div class="card-body p-0">
            {% if participaciones %}
                <div class="list-group list-group-flush">
                    {% for participacion in participaciones %}
                        <div class="list-group-item list-group-item-action border-0 py-2 py-lg-3 px-3 px-lg-4 hover-shadow transition">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="flex-grow-1 me-2">
                                    <h6 class="mb-1 mb-lg-2 fw-semibold mobile-match-title">{{ participacion.partido }}</h6>
                                    <div class="d-flex align-items-center text-muted">
                                        <i class="bi bi-calendar-event me-1 mobile-icon-small"></i>
                                        <small class="mobile-date">{{ participacion.partido.fecha|date:'d/m/Y H:i' }}</small>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-4 py-lg-5">
                    <i class="bi bi-inbox mobile-empty-icon text-muted"></i>
                    <p class="text-muted mt-2 mt-lg-3 mobile-empty-text">No hay participaciones registradas</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Bot칩n de retorno -->
    <div class="mt-3 mt-lg-4">
        <a href="javascript:history.back()" class="btn btn-outline-secondary mobile-back-btn px-3 px-lg-4">
            <i class="bi bi-arrow-left me-2"></i>Volver
        </a>
    </div>
</div>
<!-- Modal para expandir la foto en la vista de detalle -->
<div class="modal fade" id="fotoModalDetalle" tabindex="-1" aria-labelledby="fotoModalDetalleLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content" style="background: linear-gradient(135deg, #0a2342 0%, #1a365d 100%); border: 2px solid #08F7FE;">
            <div class="modal-header border-bottom" style="border-color: #08F7FE !important;">
                <h5 class="modal-title text-white" id="fotoModalDetalleLabel">Foto del Jugador</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <img id="fotoExpandidaDetalle" src="" alt="" class="img-fluid rounded" style="max-height: 70vh; object-fit: contain;">
            </div>
        </div>
    </div>
</div>

<script>
    function expandirFoto(urlFoto, nombreJugador) {
        var img = document.getElementById('fotoExpandidaDetalle');
        img.src = urlFoto;
        img.alt = nombreJugador;
        document.getElementById('fotoModalDetalleLabel').textContent = nombreJugador;
        var modal = new bootstrap.Modal(document.getElementById('fotoModalDetalle'));
        modal.show();
    }
</script>
{% endblock %}