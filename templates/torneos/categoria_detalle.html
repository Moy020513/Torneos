{% extends 'base.html' %}
{% load static %}

{% block title %}{{ categoria.nombre }} - Sistema de Torneos{% endblock %}

{% block extra_css %}
<style>
    .match-card {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        border-radius: 12px;
        padding: 15px;
        margin-bottom: 15px;
        border-left: 4px solid #0d6efd;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        transition: transform 0.3s ease;
    }
    .match-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 18px rgba(0,0,0,0.15);
    }
    .match-card.jugado {
        border-left: 4px solid #198754;
        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
    }
    .match-card.proximo {
        border-left: 4px solid #ffc107;
        background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
    }
    .team-score {
        font-size: 1.3em;
        font-weight: bold;
        color: #198754;
    }
    .vs-text {
        font-size: 0.9em;
        color: #6c757d;
        text-align: center;
        margin: 5px 0;
    }
    .match-date {
        background: linear-gradient(135deg, #0d6efd 0%, #0dcaf0 100%);
        color: white;
        border-radius: 20px;
        padding: 5px 12px;
        font-size: 0.8em;
        font-weight: bold;
    }
    .match-status {
        font-size: 0.8em;
        font-weight: bold;
        padding: 3px 10px;
        border-radius: 12px;
    }
    .status-jugado {
        background: #198754;
        color: white;
    }
    .status-proximo {
        background: #ffc107;
        color: black;
    }
    .team-logo-small {
        width: 35px;
        height: 35px;
        object-fit: contain;
    }
</style>
{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card gradient-bg text-white">
            <div class="card-body">
                <nav class="mb-4">
                    <ul class="nav nav-pills justify-content-center">
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'tabla_posiciones' categoria.id %}">Tabla de Posiciones</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'equipos' categoria.id %}"><i class="fa-solid fa-people-group"></i> Equipos</a>
                            </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'goleadores' categoria.id %}">Goleadores</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'jugadores' categoria.id %}"><i class="fa-solid fa-users"></i> Jugadores</a>
                        </li>
                        {% if categoria.tiene_eliminatorias %}
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'eliminatorias' categoria.id %}">Eliminatorias</a>
                        </li>
                        {% endif %}
                        {% if request.user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'estadisticas' categoria.id %}"><i class="fa-solid fa-chart-simple"></i> Estadísticas</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'resultados' categoria.id %}"><i class="fa-solid fa-list-check"></i> Resultados</a>
                        </li>
                        {% endif %}
                        
                    </ul>
                    <div class="d-flex justify-content-end">
                        <a href="{% url 'torneo_detalle' categoria.torneo.id %}" class="btn btn-secondary">
                            <i class="fa-solid fa-arrow-left"></i> Volver al Torneo
                        </a>
                    </div>
                </nav>
                <!-- Sección de Próximos Enfrentamientos -->
                {% if proximos_partidos %}
                    <div class="card card-gradient mb-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h3><i class="fa-solid fa-calendar-day"></i> Próximos Enfrentamientos</h3>
                            <select id="jornadaFiltro" class="form-select" style="max-width: 200px;">
                                <option value="todos">Todas las jornadas</option>
                                {% for j in jornadas %}
                                    <option value="{{ j }}">Jornada {{ j }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="card-body" id="proximos-partidos-lista">
                            {% for partido in proximos_partidos %}
                            <div class="match-card proximo" data-jornada="{{ partido.jornada }}">
                                <div class="row align-items-center">
                                    <div class="col-md-1 d-flex align-items-center justify-content-center" style="height: 100%; min-height: 70px;">
                                        <span class="match-status status-proximo mb-2">J{{ partido.jornada }}</span>
                                    </div>
                                    <div class="col-md-7">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div class="d-flex align-items-center">
                                                <div class="text-center">
                                                    {% if partido.equipo_local.logo %}
                                                    <img src="{{ partido.equipo_local.logo.url }}" alt="{{ partido.equipo_local.nombre }}" class="team-logo-small mb-1">
                                                    {% endif %}
                                                    <div>{{ partido.equipo_local.nombre }}</div>
                                                </div>
                                            </div>
                                            <div class="text-center mx-3">
                                                <div class="vs-text">VS</div>
                                                <div class="match-date">
                                                    <i class="fa-solid fa-clock"></i>
                                                    {% if partido.fecha %}{{ partido.fecha|date:"d M H:i" }}{% else %}Fecha por definir{% endif %}
                                                </div>
                                            </div>
                                            <div class="d-flex align-items-center">
                                                <div class="text-center">
                                                    {% if partido.equipo_visitante.logo %}
                                                    <img src="{{ partido.equipo_visitante.logo.url }}" alt="{{ partido.equipo_visitante.nombre }}" class="team-logo-small mb-1">
                                                    {% endif %}
                                                    <div>{{ partido.equipo_visitante.nombre }}</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 text-center">
                                        <small class="text-muted">
                                            <i class="fa-solid fa-location-dot"></i>
                                            {% if partido.campo %}{{ partido.campo }}{% else %}Por definir{% endif %}
                                        </small>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        const jornadaFiltro = document.getElementById('jornadaFiltro');
                        const partidos = document.querySelectorAll('#proximos-partidos-lista .match-card');
                        jornadaFiltro.addEventListener('change', function() {
                            const val = jornadaFiltro.value;
                            partidos.forEach(function(card) {
                                if (val === 'todos' || card.getAttribute('data-jornada') === val) {
                                    card.style.display = '';
                                } else {
                                    card.style.display = 'none';
                                }
                            });
                        });
                    });
                    </script>
                {% else %}
                    <div class="alert alert-info">
                        <i class="fa-solid fa-info-circle"></i> 
                        No hay próximos enfrentamientos programados.
                    </div>
                {% endif %}
{% endblock %}