{% extends 'torneos/base.html' %}
    {% load static %}
{% block categoria_content %}

    <!-- Encabezado/nav heredados desde torneos/base.html -->
    {% if is_admin_view %}
    <div class="card mb-4">
        <div class="card-header">
            <h3><i class="fa-solid fa-chart-simple"></i> Estadísticas Generales</h3>
        </div>
        <div class="card-body">
            <div class="row text-center">
                <div class="col-6 mb-3">
                    <div class="stats-card">
                        <h4>{{ total_partidos }}</h4>
                        <p class="text-muted">Partidos</p>
                    </div>
                </div>
                <div class="col-6 mb-3">
                    <div class="stats-card">
                        <h4>{{ partidos_jugados }}</h4>
                        <p class="text-muted">Jugados</p>
                    </div>
                </div>
                <div class="col-6 mb-3">
                    <div class="stats-card">
                        <h4>{{ partidos_pendientes }}</h4>
                        <p class="text-muted">Pendientes</p>
                    </div>
                </div>
                <div class="col-6 mb-3">
                    <div class="stats-card">
                        <h4>{{ total_goles }}</h4>
                        <p class="text-muted">Goles</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    <!-- Gráfica de goles por jornada -->
    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h3><i class="fa-solid fa-chart-bar"></i> Goles por Jornada</h3>
            <select id="equipoFiltro" class="form-select" style="max-width: 250px;">
                <option value="todos">Todos los equipos</option>
                {% for equipo in equipos %}
                    <option value="{{ equipo.id }}">{{ equipo.nombre }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="card-body">
            <style>
            /* Wrapper to allow horizontal scroll on small screens */
            .chart-scroll { overflow-x: auto; -webkit-overflow-scrolling: touch; }
            .chart-inner { display: inline-block; }
            @media (min-width: 768px) {
                /* On desktop keep canvas responsive */
                .chart-inner { display: block; width: 100%; }
            }
            </style>
            <div class="chart-scroll">
                <div class="chart-inner">
                    <canvas id="golesJornadaChart" height="120"></canvas>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{% static 'js/estadisticas.js' %}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Datos de partidos por equipo (generados por Django)
            var partidos = [
                {% for partido in partidos_para_grafico %}
                {
                    jornada: 'J{{ partido.jornada }}',
                    equipo_local_id: {{ partido.equipo_local.id }},
                    equipo_local_nombre: '{{ partido.equipo_local.nombre|escapejs }}',
                    goles_local: {{ partido.goles_local|default:0 }},
                    equipo_visitante_id: {{ partido.equipo_visitante.id }},
                    equipo_visitante_nombre: '{{ partido.equipo_visitante.nombre|escapejs }}',
                    goles_visitante: {{ partido.goles_visitante|default:0 }}
                }{% if not forloop.last %},{% endif %}
                {% endfor %}
            ];
            // Jornadas completas de la categoría (serán usadas como eje X)
            var jornadasCategoria = [
                {% for j in jornadas_categoria %}{{ j }}{% if not forloop.last %}, {% endif %}{% endfor %}
            ];
            
            // Inicializar la gráfica con los datos
            initEstadisticasChart(partidos, jornadasCategoria);
        });
    </script>
{% endblock %}
