<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Panel de Administración{% endblock %}</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/static/admin/css/admin_base.css">

</head>
<body>
    <!-- Botón Hamburguesa -->
    <button class="hamburger-btn" id="hamburgerBtn">
        <i class="fas fa-bars"></i>
    </button>
    
    <!-- Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    
    <!-- Sidebar -->
    <nav class="admin-sidebar" id="adminSidebar">
        <div class="brand">
            {% load static %}
            <img src="{% static 'img/logo.png' %}" alt="Logo">
            <h3>Admin Panel</h3>
            <p>Sistema de Torneos</p>
        </div>
        
        <div class="admin-nav">
            <!-- Volver al Sitio -->
            <div class="admin-nav-item" style="margin-bottom: 1rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 0.75rem;">
                <a href="{% url 'index' %}" class="admin-nav-link" style="background: rgba(255,255,255,0.1);">
                    <i class="fas fa-arrow-left"></i>
                    Volver al Sitio
                </a>
            </div>
            
            {% if user.is_superuser %}
            <div class="nav-section-title">Dashboard</div>
            <div class="admin-nav-item">
                <a href="{% url 'admin_dashboard' %}" class="admin-nav-link {% if request.resolver_match.url_name == 'admin_dashboard' %}active{% endif %}">
                    <i class="fas fa-tachometer-alt"></i>
                    Dashboard Principal
                </a>
            </div>
            
            <div class="nav-section-title">Gestión de Torneos</div>
            <div class="admin-nav-item">
                <a href="{% url 'admin_torneos' %}" class="admin-nav-link {% if 'torneo' in request.resolver_match.url_name %}active{% endif %}">
                    <i class="fas fa-trophy"></i>
                    Torneos
                </a>
            </div>
            <div class="admin-nav-item">
                <a href="{% url 'admin_categorias' %}" class="admin-nav-link {% if 'categoria' in request.resolver_match.url_name %}active{% endif %}">
                    <i class="fas fa-tags"></i>
                    Categorías
                </a>
            </div>
            {% endif %}

            {# Enlace específico para administradores del torneo asignado #}
            {% if is_torneo_admin and torneo_admin_obj and torneo_admin_obj.torneo %}
            <div class="nav-section-title">Mi Torneo</div>
            <div class="admin-nav-item">
                <a href="{% url 'administrar_torneo' torneo_admin_obj.torneo.id %}" class="admin-nav-link {% if request.resolver_match.url_name == 'administrar_torneo' %}active{% endif %}">
                    <i class="fas fa-user-shield"></i>
                    Panel del Torneo
                </a>
            </div>
            <div class="admin-nav-item">
                <a href="{% url 'admin_editar_torneo' torneo_admin_obj.torneo.id %}" class="admin-nav-link {% if request.resolver_match.url_name == 'admin_editar_torneo' %}active{% endif %}">
                    <i class="fas fa-edit"></i>
                    Editar Torneo
                </a>
            </div>
            <div class="admin-nav-item">
                <a href="{% url 'admin_categorias' %}" class="admin-nav-link {% if 'categoria' in request.resolver_match.url_name %}active{% endif %}">
                    <i class="fas fa-tags"></i>
                    Categorías
                </a>
            </div>
            {% endif %}
            
            <div class="nav-section-title">Gestión de Equipos</div>
            <div class="admin-nav-item">
                <a href="{% url 'admin_equipos' %}" class="admin-nav-link {% if 'equipo' in request.resolver_match.url_name %}active{% endif %}">
                    <i class="fas fa-users"></i>
                    Equipos
                </a>
            </div>
            <div class="admin-nav-item">
                <a href="{% url 'admin_jugadores' %}" class="admin-nav-link {% if 'jugador' in request.resolver_match.url_name %}active{% endif %}">
                    <i class="fas fa-user"></i>
                    Jugadores
                </a>
            </div>
            <div class="admin-nav-item">
                <a href="{% url 'admin_arbitros' %}" class="admin-nav-link {% if 'arbitro' in request.resolver_match.url_name %}active{% endif %}">
                    <i class="fas fa-flag-checkered"></i>
                    Árbitros
                </a>
            </div>
            <div class="admin-nav-item">
                <a href="{% url 'admin_representantes' %}" class="admin-nav-link {% if 'representante' in request.resolver_match.url_name %}active{% endif %}">
                    <i class="fas fa-user-tie"></i>
                    Representantes
                </a>
            </div>
            
            <div class="nav-section-title">Gestión de Partidos</div>
            <div class="admin-nav-item">
                <a href="{% url 'admin_campos' %}" class="admin-nav-link {% if 'campo' in request.resolver_match.url_name %}active{% endif %}">
                    <i class="fas fa-map-marker-alt"></i>
                    Campos
                </a>
            </div>
            <div class="admin-nav-item">
                <a href="{% url 'admin_partidos' %}" class="admin-nav-link {% if 'partido' in request.resolver_match.url_name and 'eliminatoria' not in request.resolver_match.url_name %}active{% endif %}">
                    <i class="fas fa-futbol"></i>
                    Partidos
                </a>
            </div>
            <div class="admin-nav-item">
                <a href="{% url 'admin_partidos_eliminatoria' %}" class="admin-nav-link {% if 'partido' in request.resolver_match.url_name and 'eliminatoria' in request.resolver_match.url_name %}active{% endif %}">
                    <i class="fas fa-fire"></i>
                    Partidos Eliminatoria
                </a>
            </div>
            <div class="admin-nav-item">
                <a href="{% url 'admin_participaciones' %}" class="admin-nav-link {% if 'participacion' in request.resolver_match.url_name %}active{% endif %}">
                    <i class="fas fa-running"></i>
                    Partidos Jugados
                </a>
            </div>
            <div class="admin-nav-item">
                <a href="{% url 'admin_eliminatorias' %}" class="admin-nav-link {% if 'eliminatoria' in request.resolver_match.url_name and 'partido' not in request.resolver_match.url_name %}active{% endif %}">
                    <i class="fas fa-trophy"></i>
                    Eliminatorias
                </a>
            </div>
            <div class="admin-nav-item">
                <a href="{% url 'admin_grupos' %}" class="admin-nav-link {% if 'grupo' in request.resolver_match.url_name %}active{% endif %}">
                    <i class="fas fa-layer-group"></i>
                    Grupos
                </a>
            </div>
            <div class="admin-nav-item">
                <a href="{% url 'admin_goleadores' %}" class="admin-nav-link {% if 'goleador' in request.resolver_match.url_name %}active{% endif %}">
                    <i class="fas fa-bullseye"></i>
                    Goleadores
                </a>
            </div>
            <div class="admin-nav-item">
                <a href="{% url 'admin_ajustar_puntos' %}" class="admin-nav-link {% if 'ajustar_puntos' in request.resolver_match.url_name %}active{% endif %}">
                    <i class="fas fa-calculator"></i>
                    Ajustar Puntos
                </a>
            </div>
            
            <div class="nav-section-title">Sistema</div>
            <div class="admin-nav-item">
                <a href="{% url 'admin_usuarios' %}" class="admin-nav-link {% if 'usuario' in request.resolver_match.url_name %}active{% endif %}">
                    <i class="fas fa-user-cog"></i>
                    Usuarios
                </a>
            </div>
            {% if user.is_superuser %}
            <div class="admin-nav-item">
                <a href="{% url 'admin:torneos_administradortorneo_changelist' %}" class="admin-nav-link {% if 'administradortorneo' in request.resolver_match.url_name %}active{% endif %}">
                    <i class="fas fa-user-shield"></i>
                    Administradores Torneo
                </a>
            </div>
            {% endif %}
            <div class="admin-nav-item">
                <a href="{% url 'admin_reportes' %}" class="admin-nav-link {% if 'reporte' in request.resolver_match.url_name %}active{% endif %}">
                    <i class="fas fa-chart-bar"></i>
                    Reportes
                </a>
            </div>
            <div class="admin-nav-item">
                <a href="{% url 'admin_actividades' %}" class="admin-nav-link {% if 'actividade' in request.resolver_match.url_name %}active{% endif %}">
                    <i class="fas fa-history"></i>
                    Registro de Actividades
                </a>
            </div>
            <div class="admin-nav-item">
                <a href="{% url 'admin_herramientas' %}" class="admin-nav-link {% if 'herramienta' in request.resolver_match.url_name %}active{% endif %}">
                    <i class="fas fa-tools"></i>
                    Herramientas
                </a>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <main class="admin-main">
        <header class="admin-header">
            <div class="admin-header-content">
                <h1>{% block page_title %}SuperAdministrador{% endblock %}</h1>
                <div class="admin-header-actions">
                    <span class="text-muted">Bienvenido, {{ user.get_full_name|default:user.username }}</span>
                    <a href="{% url 'logout' %}" class="btn btn-outline-secondary btn-sm">
                        <i class="fas fa-sign-out-alt"></i>
                        Salir
                    </a>
                </div>
            </div>
        </header>
        
        <div class="admin-content">
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
            
            {% block content %}{% endblock %}
        </div>
    </main>
    
    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Script para el menú hamburguesa -->
    <script>
        // Inicializar elementos
        const hamburgerBtn = document.getElementById('hamburgerBtn');
        const adminSidebar = document.getElementById('adminSidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        
        // Forzar un reflow inicial para activar las transiciones correctamente
        window.addEventListener('DOMContentLoaded', () => {
            adminSidebar.offsetHeight; // Trigger reflow
        });
        
        function toggleSidebar() {
            adminSidebar.classList.toggle('show');
            sidebarOverlay.classList.toggle('active');
            hamburgerBtn.classList.toggle('active');
        }
        
        hamburgerBtn.addEventListener('click', toggleSidebar);
        sidebarOverlay.addEventListener('click', toggleSidebar);
        
        // Cerrar sidebar al hacer clic en un enlace (opcional, útil en móviles)
        const navLinks = document.querySelectorAll('.admin-nav-link');
        navLinks.forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth <= 768) {
                    toggleSidebar();
                }
            });
        });
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>