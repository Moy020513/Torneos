{% extends 'admin/admin_base.html' %}
{% load static %}

{% block page_title %}{{ action }} Árbitro{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="mb-1">{{ action }} Árbitro</h2>
        <p class="text-muted mb-0">Asigne un usuario como árbitro para un torneo</p>
    </div>
    <div>
        <a href="{% url 'admin_arbitros' %}" class="btn btn-outline-secondary"><i class="fas fa-arrow-left me-2"></i>Volver</a>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="admin-card">
            <div class="admin-card-header">
                <h3><i class="fas fa-flag-checkered me-2"></i>Datos del Árbitro</h3>
            </div>
            <div class="admin-card-body">
                <form method="post">
                    {% csrf_token %}
                    <div class="admin-form-group">
                        <label class="admin-form-label" for="{{ form.usuario.id_for_label }}">{{ form.usuario.label }} <span class="text-danger">*</span></label>
                        {{ form.usuario }}
                        {% if form.usuario.errors %}
                            <div class="text-danger small mt-1">{% for error in form.usuario.errors %}<div>{{ error }}</div>{% endfor %}</div>
                        {% endif %}
                        <div class="form-text">Seleccione el usuario que actuará como árbitro</div>
                    </div>

                    <div class="admin-form-group">
                        <label class="admin-form-label" for="{{ form.torneo.id_for_label }}">{{ form.torneo.label }} <span class="text-danger">*</span></label>
                        {{ form.torneo }}
                        {% if form.torneo.errors %}
                            <div class="text-danger small mt-1">{% for error in form.torneo.errors %}<div>{{ error }}</div>{% endfor %}</div>
                        {% endif %}
                        <div class="form-text">Torneo al que se le podrán asignar partidos</div>
                    </div>

                    <div class="admin-form-group">
                        <div class="form-check">
                            {{ form.activo }}
                            <label class="form-check-label" for="{{ form.activo.id_for_label }}">{{ form.activo.label }}</label>
                        </div>
                        {% if form.activo.errors %}
                            <div class="text-danger small mt-1">{% for error in form.activo.errors %}<div>{{ error }}</div>{% endfor %}</div>
                        {% endif %}
                    </div>

                    {% if form.non_field_errors %}
                        <div class="alert alert-danger mt-3">{% for error in form.non_field_errors %}<div>{{ error }}</div>{% endfor %}</div>
                    {% endif %}

                    <div class="d-flex justify-content-between mt-4 pt-3 border-top">
                        <a href="{% url 'admin_arbitros' %}" class="btn btn-outline-secondary"><i class="fas fa-times me-2"></i>Cancelar</a>
                        <button type="submit" class="btn btn-admin"><i class="fas fa-save me-2"></i>{{ action }} Árbitro</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <div class="admin-card">
            <div class="admin-card-header">
                <h3><i class="fas fa-info-circle me-2"></i>Ayuda</h3>
            </div>
            <div class="admin-card-body">
                <p class="small text-muted">El usuario seleccionado recibirá acceso al panel de árbitro y podrá cargar resultados únicamente de los partidos que se le asignen.</p>
                <ul class="small text-muted">
                    <li>Un usuario solo puede ser árbitro de un torneo.</li>
                    <li>El administrador del torneo puede crear el usuario y asignarlo.</li>
                    <li>Los partidos asignados se mantendrán si desactiva al árbitro, pero no podrá acceder al panel.</li>
                </ul>
                {% if action == 'Editar' and arbitro %}
                    <div class="border-top pt-3 mt-3 small">
                        <div class="d-flex justify-content-between"><span>Usuario:</span><span class="fw-semibold">{{ arbitro.usuario.username }}</span></div>
                        <div class="d-flex justify-content-between"><span>Torneo:</span><span class="fw-semibold">{{ arbitro.torneo.nombre }}</span></div>
                        <div class="d-flex justify-content-between"><span>Asignado:</span><span class="fw-semibold">{{ arbitro.fecha_creacion|date:"d/m/Y" }}</span></div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
